<link rel="stylesheet" href="highlightjs/styles/default.css">
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> MPE</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;athread.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><span class="hljs-comment">//#include &lt;mpi.h&gt;</span><span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">void</span> <span class="hljs-title">slave_test</span><span class="hljs-params">(<span class="hljs-keyword">int</span> nloops)</span></span>;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span></span>{  <span class="hljs-comment">//MPI_Init(&amp;argc, &amp;argv);</span>  athread_init();  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"post init"</span>);  athread_spawn(test, <span class="hljs-number">1000000</span>);  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"post spawn"</span>);  athread_join();  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"post join"</span>);  athread_halt();  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"post halt"</span>);}<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> CPE</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;slave.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">(<span class="hljs-keyword">int</span> nloops)</span></span>{  <span class="hljs-keyword">int</span> i;  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; nloops; i ++){    <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> a = _MYID, b = <span class="hljs-number">64</span> - _MYID, c = <span class="hljs-number">64</span>, d = <span class="hljs-number">0</span>;    <span class="hljs-keyword">while</span> (a --);    <span class="hljs-keyword">while</span> (b --);    <span class="hljs-keyword">while</span> (c --);    <span class="hljs-keyword">while</span> (d --);  }}<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
